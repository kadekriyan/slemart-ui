<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pesanan Saya - Sleman Mart</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#E57F39",
              "primary-dark": "#C86A2B",
              "primary-light": "#F29C5E",
            },
          },
        },
      };
    </script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-md sticky top-0 z-50">
      <div class="container mx-auto px-4">
        <div class="flex items-center justify-between h-16">
          <div class="flex items-center">
            <div class="text-xl sm:text-2xl font-bold text-primary">
              <i class="fas fa-store mr-2"></i
              ><a href="index.html">Sleman Mart</a>
            </div>
          </div>

          <div class="flex items-center space-x-2 sm:space-x-4">
            <a
              href="cart.html"
              class="relative text-gray-500 hover:text-primary"
            >
              <i class="fas fa-shopping-cart text-lg sm:text-xl"></i>
              <span
                class="absolute -top-2 -right-2 bg-primary text-white text-xs rounded-full h-5 w-5 flex items-center justify-center"
                >0</span
              >
            </a>

            <!-- Profile Dropdown -->
            <div class="relative group">
              <button
                class="flex items-center text-primary hover:text-primary-dark transition duration-300"
              >
                <i
                  class="fas fa-user-circle text-lg sm:text-xl mr-1 sm:mr-2"
                ></i>
                <span class="hidden sm:inline text-sm sm:text-base"
                  >Kadek Riyan</span
                >
                <i class="fas fa-chevron-down text-xs ml-1"></i>
              </button>

              <!-- Dropdown Menu -->
              <div
                class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-50"
              >
                <div class="py-2">
                  <a
                    href="products.html"
                    class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 transition duration-200"
                  >
                    <i class="fas fa-home mr-3 text-gray-500"></i>
                    <span>Beranda</span>
                  </a>
                  <a
                    href="profile.html"
                    class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 transition duration-200"
                  >
                    <i class="fas fa-user mr-3 text-gray-500"></i>
                    <span>Profil</span>
                  </a>
                  <a
                    href="orders.html"
                    class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 transition duration-200"
                  >
                    <i class="fas fa-box mr-3 text-gray-500"></i>
                    <span>Pesanan Saya</span>
                  </a>
                  <a
                    href="report-status.html"
                    class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 transition duration-200"
                  >
                    <i
                      class="fas fa-exclamation-triangle mr-3 text-gray-500"
                    ></i>
                    <span>Laporan Masalah</span>
                  </a>
                  <hr class="my-2" />
                  <a
                    href="index.html"
                    class="flex items-center px-4 py-2 text-red-600 hover:bg-red-50 transition duration-200"
                  >
                    <i class="fas fa-sign-out-alt mr-3"></i>
                    <span>Keluar</span>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <div class="container mx-auto px-4 py-4 sm:py-8">
      <!-- Breadcrumb -->
      <nav class="mb-4 sm:mb-6">
        <ol
          class="flex items-center space-x-2 text-xs sm:text-sm text-gray-500 overflow-x-auto whitespace-nowrap"
        >
          <li>
            <a href="index.html" class="hover:text-primary flex-shrink-0"
              >Beranda</a
            >
          </li>
          <li><i class="fas fa-chevron-right text-xs flex-shrink-0"></i></li>
          <li>
            <a href="profile.html" class="hover:text-primary flex-shrink-0"
              >Profile</a
            >
          </li>
          <li><i class="fas fa-chevron-right text-xs flex-shrink-0"></i></li>
          <li class="text-gray-900 truncate">Pesanan Saya</li>
        </ol>
      </nav>

      <!-- Page Header -->
      <div class="mb-6 sm:mb-8">
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">
          Pesanan Saya
        </h1>
        <p class="text-sm sm:text-base text-gray-600">
          Kelola dan lacak semua pesanan Anda
        </p>
      </div>

      <div class="grid lg:grid-cols-4 gap-4 sm:gap-8">
        <!-- Order Filters -->
        <div class="lg:col-span-1">
          <div class="bg-white rounded-lg shadow-md p-4 sm:p-6">
            <h3 class="text-base sm:text-lg font-semibold mb-4">
              Filter Pesanan
            </h3>

            <!-- Status Filter -->
            <div class="mb-4 sm:mb-6">
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Status Pesanan</label
              >
              <select
                id="statusFilter"
                class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
              >
                <option value="">Semua Status</option>
                <option value="unpaid">Belum Dibayar</option>
                <option value="payment_pending">Menunggu Verifikasi</option>
                <option value="payment_rejected">Pembayaran Ditolak</option>
                <option value="paid">Pembayaran Berhasil</option>
                <option value="processing">Diproses</option>
                <option value="packed">Dikemas</option>
                <option value="shipped">Dikirim</option>
                <option value="completed">Selesai</option>
                <option value="refunded">Dana Dikembalikan</option>
                <option value="cancelled">Dibatalkan</option>
              </select>
            </div>

            <!-- Date Range -->
            <div class="mb-4 sm:mb-6">
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Periode</label
              >
              <div class="space-y-2">
                <input
                  type="date"
                  id="startDate"
                  class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                />
                <input
                  type="date"
                  id="endDate"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                />
              </div>
            </div>

            <!-- Search -->
            <div class="mb-6">
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Cari Pesanan</label
              >
              <input
                type="text"
                id="searchOrder"
                placeholder="Nomor pesanan atau nama produk"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
              />
            </div>

            <button
              onclick="applyFilters()"
              class="w-full bg-primary text-white py-2 px-4 rounded-md hover:bg-primary-dark transition duration-300"
            >
              <i class="fas fa-filter mr-2"></i>Terapkan Filter
            </button>
          </div>
        </div>

        <!-- Orders List -->
        <div class="lg:col-span-3">
          <!-- Order Status Tabs -->
          <div class="bg-white rounded-lg shadow-md mb-4 sm:mb-6">
            <div class="border-b border-gray-200">
              <nav
                class="flex space-x-2 sm:space-x-8 px-4 sm:px-6 overflow-x-auto"
                aria-label="Tabs"
              >
                <button
                  onclick="filterByStatus('')"
                  class="tab-button border-b-2 border-primary text-primary py-3 sm:py-4 px-1 text-xs sm:text-sm font-medium whitespace-nowrap"
                >
                  Semua
                  <span
                    class="hidden sm:inline bg-primary text-white px-2 py-1 rounded-full text-xs ml-2"
                    >8</span
                  >
                </button>
                <button
                  onclick="filterByStatus('unpaid')"
                  class="tab-button border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-3 sm:py-4 px-1 text-xs sm:text-sm font-medium whitespace-nowrap"
                >
                  Belum Bayar
                  <span
                    class="hidden sm:inline bg-gray-200 text-gray-700 px-2 py-1 rounded-full text-xs ml-2"
                    >1</span
                  >
                </button>
                <button
                  onclick="filterByStatus('payment_pending')"
                  class="tab-button border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-3 sm:py-4 px-1 text-xs sm:text-sm font-medium whitespace-nowrap"
                >
                  Verifikasi
                  <span
                    class="hidden sm:inline bg-gray-200 text-gray-700 px-2 py-1 rounded-full text-xs ml-2"
                    >1</span
                  >
                </button>
                <button
                  onclick="filterByStatus('payment_rejected')"
                  class="tab-button border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-3 sm:py-4 px-1 text-xs sm:text-sm font-medium whitespace-nowrap"
                >
                  Ditolak
                  <span
                    class="hidden sm:inline bg-gray-200 text-gray-700 px-2 py-1 rounded-full text-xs ml-2"
                    >1</span
                  >
                </button>
                <button
                  onclick="filterByStatus('shipped')"
                  class="tab-button border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-3 sm:py-4 px-1 text-xs sm:text-sm font-medium whitespace-nowrap"
                >
                  Dikirim
                  <span
                    class="hidden sm:inline bg-gray-200 text-gray-700 px-2 py-1 rounded-full text-xs ml-2"
                    >1</span
                  >
                </button>
                <button
                  onclick="filterByStatus('completed')"
                  class="tab-button border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-3 sm:py-4 px-1 text-xs sm:text-sm font-medium whitespace-nowrap"
                >
                  Selesai
                  <span
                    class="hidden sm:inline bg-gray-200 text-gray-700 px-2 py-1 rounded-full text-xs ml-2"
                    >1</span
                  >
                </button>
              </nav>
            </div>
          </div>

          <!-- Orders Container -->
          <div id="ordersContainer" class="space-y-3 sm:space-y-4">
            <!-- Orders will be populated by JavaScript -->
          </div>

          <!-- Empty State -->
          <div
            id="emptyOrders"
            class="hidden bg-white rounded-lg shadow-md p-8 sm:p-12 text-center"
          >
            <i
              class="fas fa-shopping-bag text-4xl sm:text-6xl text-gray-300 mb-4"
            ></i>
            <h3 class="text-lg sm:text-xl font-semibold text-gray-600 mb-2">
              Belum Ada Pesanan
            </h3>
            <p class="text-sm sm:text-base text-gray-500 mb-6">
              Anda belum memiliki pesanan dengan filter yang dipilih
            </p>
            <a
              href="products.html"
              class="bg-primary text-white px-4 sm:px-6 py-3 rounded-md hover:bg-primary-dark transition duration-300 text-sm sm:text-base"
            >
              <i class="fas fa-shopping-bag mr-2"></i>Mulai Belanja
            </a>
          </div>

          <!-- Load More -->
          <div class="text-center mt-6 sm:mt-8">
            <button
              onclick="loadMoreOrders()"
              class="bg-gray-200 text-gray-700 px-4 sm:px-6 py-3 rounded-md hover:bg-gray-300 transition duration-300 text-sm sm:text-base"
            >
              <i class="fas fa-plus mr-2"></i>Muat Lebih Banyak
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Order Detail Modal -->
    <div
      id="orderModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden z-50"
    >
      <div class="flex items-center justify-center min-h-screen p-4">
        <div
          class="bg-white rounded-lg w-full max-w-2xl max-h-screen overflow-y-auto"
        >
          <div id="modalContent" class="p-4 sm:p-6">
            <!-- Modal content will be populated by JavaScript -->
          </div>
        </div>
      </div>
    </div>

    <!-- Review Items Modal -->
    <div
      id="reviewItemsModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden z-50"
    >
      <div class="flex items-center justify-center min-h-screen p-4">
        <div
          class="bg-white rounded-lg max-w-2xl w-full mx-4 max-h-screen overflow-y-auto"
        >
          <div class="p-4 sm:p-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-base sm:text-lg font-semibold">
                Pilih Produk untuk Diulas
              </h3>
              <button
                onclick="closeReviewItemsModal()"
                class="text-gray-500 hover:text-gray-700"
              >
                <i class="fas fa-times"></i>
              </button>
            </div>

            <div class="mb-4">
              <p class="text-sm text-gray-600">
                Pesanan
                <span
                  id="reviewOrderId"
                  class="font-medium text-primary"
                ></span>
              </p>
            </div>

            <!-- Items List -->
            <div id="reviewItemsList" class="space-y-3 mb-6">
              <!-- Items will be populated by JavaScript -->
            </div>

            <div class="flex justify-end">
              <button
                onclick="closeReviewItemsModal()"
                class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition duration-300"
              >
                Tutup
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Review Modal -->
    <div
      id="reviewModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden z-50"
    >
      <div class="flex items-center justify-center min-h-screen p-4">
        <div
          class="bg-white rounded-lg max-w-lg w-full mx-4 max-h-screen overflow-y-auto"
        >
          <div class="p-4 sm:p-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-base sm:text-lg font-semibold">
                Beri Ulasan Produk
              </h3>
              <button
                onclick="closeReviewModal()"
                class="text-gray-500 hover:text-gray-700"
              >
                <i class="fas fa-times"></i>
              </button>
            </div>

            <!-- Product Info -->
            <div id="reviewProductInfo" class="bg-gray-50 rounded-lg p-4 mb-4">
              <!-- Product info will be populated by JavaScript -->
            </div>

            <form id="reviewForm">
              <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Rating Produk</label
                >
                <div class="flex space-x-1">
                  <i
                    class="fas fa-star text-gray-300 text-xl sm:text-2xl cursor-pointer rating-star"
                    data-rating="1"
                  ></i>
                  <i
                    class="fas fa-star text-gray-300 text-xl sm:text-2xl cursor-pointer rating-star"
                    data-rating="2"
                  ></i>
                  <i
                    class="fas fa-star text-gray-300 text-xl sm:text-2xl cursor-pointer rating-star"
                    data-rating="3"
                  ></i>
                  <i
                    class="fas fa-star text-gray-300 text-xl sm:text-2xl cursor-pointer rating-star"
                    data-rating="4"
                  ></i>
                  <i
                    class="fas fa-star text-gray-300 text-xl sm:text-2xl cursor-pointer rating-star"
                    data-rating="5"
                  ></i>
                </div>
                <p class="text-xs text-gray-500 mt-1">
                  Klik bintang untuk memberikan rating
                </p>
              </div>

              <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Ulasan Anda</label
                >
                <textarea
                  id="reviewComment"
                  rows="4"
                  class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                  placeholder="Bagikan pengalaman Anda tentang produk ini..."
                ></textarea>
              </div>

              <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Foto Produk (Opsional)</label
                >
                <div
                  class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center"
                >
                  <input
                    type="file"
                    id="reviewMedia"
                    accept="image/*"
                    multiple
                    class="hidden"
                  />
                  <label for="reviewMedia" class="cursor-pointer">
                    <i
                      class="fas fa-camera text-xl sm:text-2xl text-gray-400 mb-2"
                    ></i>
                    <p class="text-sm text-gray-600">
                      Upload foto produk yang Anda terima
                    </p>
                    <p class="text-xs text-gray-500">
                      Max 5 foto, 10MB per file
                    </p>
                  </label>
                </div>
              </div>

              <div
                class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3"
              >
                <button
                  type="button"
                  onclick="closeReviewModal()"
                  class="flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 text-sm sm:text-base"
                >
                  Batal
                </button>
                <button
                  type="submit"
                  class="flex-1 bg-primary text-white py-2 px-4 rounded-md hover:bg-primary-dark text-sm sm:text-base"
                >
                  Kirim Ulasan
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- View Review Modal -->
    <div
      id="viewReviewModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden z-50"
    >
      <div class="flex items-center justify-center min-h-screen p-4">
        <div
          class="bg-white rounded-lg max-w-lg w-full mx-4 max-h-screen overflow-y-auto"
        >
          <div class="p-4 sm:p-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-base sm:text-lg font-semibold">Ulasan Produk</h3>
              <button
                onclick="closeViewReviewModal()"
                class="text-gray-500 hover:text-gray-700"
              >
                <i class="fas fa-times"></i>
              </button>
            </div>

            <!-- Product Info -->
            <div
              id="viewReviewProductInfo"
              class="bg-gray-50 rounded-lg p-4 mb-4"
            >
              <!-- Product info will be populated by JavaScript -->
            </div>

            <!-- Review Details -->
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Rating Anda</label
                >
                <div id="viewReviewRating" class="flex space-x-1">
                  <!-- Stars will be populated by JavaScript -->
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Ulasan Anda</label
                >
                <div
                  id="viewReviewComment"
                  class="bg-gray-50 rounded-lg p-3 text-sm text-gray-700 min-h-[60px]"
                >
                  <!-- Comment will be populated by JavaScript -->
                </div>
              </div>

              <div id="viewReviewMediaSection" class="hidden">
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Foto/Video</label
                >
                <div id="viewReviewMedia" class="grid grid-cols-2 gap-2">
                  <!-- Media will be populated by JavaScript -->
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2"
                  >Tanggal Ulasan</label
                >
                <p id="viewReviewDate" class="text-sm text-gray-600">
                  <!-- Date will be populated by JavaScript -->
                </p>
              </div>
            </div>

            <div class="mt-6">
              <button
                onclick="closeViewReviewModal()"
                class="w-full bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 text-sm sm:text-base"
              >
                Tutup
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-12 mt-16">
      <div class="container mx-auto px-4">
        <div class="grid md:grid-cols-4 gap-8">
          <div>
            <h3 class="text-xl font-bold mb-4">Sleman Mart</h3>
            <p class="text-gray-300">
              Platform e-commerce untuk UMKM di Sleman yang mendukung produk
              lokal berkualitas.
            </p>
          </div>
          <div>
            <h4 class="font-semibold mb-4">Link Cepat</h4>
            <ul class="space-y-2">
              <li>
                <a href="products.html" class="text-gray-300 hover:text-primary"
                  >Produk</a
                >
              </li>
              <li>
                <a
                  href="categories.html"
                  class="text-gray-300 hover:text-primary"
                  >Kategori</a
                >
              </li>
              <li>
                <a href="sellers.html" class="text-gray-300 hover:text-primary"
                  >Penjual</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h4 class="font-semibold mb-4">Bantuan</h4>
            <ul class="space-y-2">
              <li>
                <a href="help.html" class="text-gray-300 hover:text-primary"
                  >Pusat Bantuan</a
                >
              </li>
              <li>
                <a href="contact.html" class="text-gray-300 hover:text-primary"
                  >Kontak</a
                >
              </li>
            </ul>
          </div>
          <div>
            <h4 class="font-semibold mb-4">Hubungi Kami</h4>
            <p class="text-gray-300 mb-2">Email: info@slemanmart.com</p>
            <p class="text-gray-300 mb-4">Telepon: (0274) 123-4567</p>
          </div>
        </div>
        <div
          class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-300"
        >
          <p>&copy; 2025 Sleman Mart. Semua hak cipta dilindungi.</p>
        </div>
      </div>
    </footer>

    <script>
      let currentFilter = "";
      let selectedRating = 0;
      let currentReviewOrderId = null;
      let currentReviewItem = null;

      // Sample orders data - Updated with payment status flow
      const orders = [
        {
          id: "SLM240005",
          date: "2025-09-01",
          status: "unpaid",
          statusText: "Belum Dibayar",
          statusClass: "bg-red-100 text-red-800",
          paymentStatus: "unpaid",
          items: [
            {
              name: "Kue Lapis Tradisional",
              seller: "Toko Kue Bu Sari",
              price: 15000,
              quantity: 2,
              image: "placeholder",
            },
            {
              name: "Es Teh Manis",
              seller: "Warung Minuman Segar",
              price: 5000,
              quantity: 1,
              image: "placeholder",
            },
            {
              name: "Keripik Singkong Pedas",
              seller: "Toko Kue Bu Sari",
              price: 12000,
              quantity: 3,
              image: "placeholder",
            },
            {
              name: "Bandrek Jahe Hangat",
              seller: "Warung Minuman Segar",
              price: 8000,
              quantity: 2,
              image: "placeholder",
            },
          ],
          shipping: {
            address: "Jl. Kaliurang KM 5, Sleman",
            cost: 10000,
          },
          total: 77000,
        },
        {
          id: "SLM240004",
          date: "2025-08-31",
          status: "payment_pending",
          statusText: "Menunggu Verifikasi",
          statusClass: "bg-yellow-100 text-yellow-800",
          paymentStatus: "pending",
          items: [
            {
              name: "Batik Jumputan Premium",
              seller: "Batik Sleman Asri",
              price: 125000,
              quantity: 1,
              image: "placeholder",
            },
            {
              name: "Kain Lurik Motif Klasik",
              seller: "Batik Sleman Asri",
              price: 85000,
              quantity: 2,
              image: "placeholder",
            },
            {
              name: "Tas Anyaman Pandan",
              seller: "Kerajinan Lokal Sleman",
              price: 45000,
              quantity: 1,
              image: "placeholder",
            },
          ],
          shipping: {
            address: "Jl. Magelang KM 3, Sleman",
            cost: 15000,
          },
          total: 355000,
          paymentProofUploaded: true,
        },
        {
          id: "SLM240003",
          date: "2025-08-30",
          status: "payment_rejected",
          statusText: "Pembayaran Ditolak",
          statusClass: "bg-red-100 text-red-800",
          paymentStatus: "rejected",
          rejectionReason:
            "Bukti pembayaran tidak jelas. Nominal yang tertera tidak sesuai dengan total pesanan.",
          items: [
            {
              name: "Gula Aren Organik",
              seller: "Aren Murni Sleman",
              price: 25000,
              quantity: 3,
              image: "placeholder",
            },
            {
              name: "Madu Kelengkeng Asli",
              seller: "Aren Murni Sleman",
              price: 45000,
              quantity: 2,
              image: "placeholder",
            },
            {
              name: "Sirup Temulawak",
              seller: "Herbal Sleman Sehat",
              price: 18000,
              quantity: 2,
              image: "placeholder",
            },
            {
              name: "Jahe Merah Bubuk",
              seller: "Herbal Sleman Sehat",
              price: 22000,
              quantity: 1,
              image: "placeholder",
            },
          ],
          shipping: {
            address: "Jl. Solo KM 10, Sleman",
            cost: 12000,
          },
          total: 189000,
        },
        {
          id: "SLM240002",
          date: "2025-08-29",
          status: "paid",
          statusText: "Pembayaran Berhasil",
          statusClass: "bg-green-100 text-green-800",
          paymentStatus: "paid",
          items: [
            {
              name: "Madu Hutan Murni",
              seller: "Madu Asli Sleman",
              price: 85000,
              quantity: 1,
              image: "placeholder",
            },
            {
              name: "Propolis Cair Premium",
              seller: "Madu Asli Sleman",
              price: 95000,
              quantity: 1,
              image: "placeholder",
            },
            {
              name: "Royal Jelly Kapsul",
              seller: "Madu Asli Sleman",
              price: 125000,
              quantity: 1,
              image: "placeholder",
            },
          ],
          shipping: {
            address: "Jl. Godean KM 7, Sleman",
            cost: 15000,
          },
          total: 320000,
        },
        {
          id: "SLM240001",
          date: "2025-08-28",
          status: "shipped",
          statusText: "Dikirim",
          statusClass: "bg-blue-100 text-blue-800",
          paymentStatus: "paid",
          items: [
            {
              name: "Keripik Tempe Original",
              seller: "Toko Cemilan Sleman",
              price: 15000,
              quantity: 2,
              image: "placeholder",
            },
            {
              name: "Keripik Tahu Crispy",
              seller: "Toko Cemilan Sleman",
              price: 12000,
              quantity: 3,
              image: "placeholder",
            },
            {
              name: "Rempeyek Kacang",
              seller: "Toko Cemilan Sleman",
              price: 10000,
              quantity: 4,
              image: "placeholder",
            },
            {
              name: "Kripik Pisang Manis",
              seller: "Camilan Tradisional",
              price: 14000,
              quantity: 2,
              image: "placeholder",
            },
            {
              name: "Opak Singkong",
              seller: "Camilan Tradisional",
              price: 8000,
              quantity: 3,
              image: "placeholder",
            },
          ],
          shipping: {
            address: "Jl. Kaliurang KM 5, Sleman",
            cost: 12000,
            // Bukti pengiriman dari penjual (maksimal 3 foto)
            shippingProof: [
              "images/packing.jpg",
              "images/pack.jpg",
              "images/terpacking.jpg",
            ],
            // Catatan pengiriman dari pengirim
            shippingNote: "sudahhh yaaa kak, terimakasih",
          },
          total: 146000,
          trackingNumber: "JNE123456789",
        },
        {
          id: "SLM239999",
          date: "2025-08-25",
          status: "completed",
          statusText: "Selesai",
          statusClass: "bg-green-100 text-green-800",
          paymentStatus: "paid",
          items: [
            {
              name: "Batik Jumputan",
              seller: "Batik Sleman Asri",
              price: 125000,
              quantity: 1,
              image: "placeholder",
            },
            {
              name: "Blangkon Yogya Asli",
              seller: "Batik Sleman Asri",
              price: 75000,
              quantity: 1,
              image: "placeholder",
            },
            {
              name: "Kaos Motif Gudeg",
              seller: "Fashion Lokal Jogja",
              price: 65000,
              quantity: 2,
              image: "placeholder",
            },
            {
              name: "Sandal Kulit Magetan",
              seller: "Kerajinan Kulit Sleman",
              price: 95000,
              quantity: 1,
              image: "placeholder",
            },
          ],
          shipping: {
            address: "Jl. Magelang KM 3, Sleman",
            cost: 15000,
          },
          total: 440000,
          canReview: true,
          reviewedItems: [0, 2], // Some items already reviewed
        },
        {
          id: "SLM239998",
          date: "2025-08-20",
          status: "refunded",
          statusText: "Dana Dikembalikan",
          statusClass: "bg-blue-100 text-blue-800",
          paymentStatus: "refunded",
          refundReason: "Produk tidak tersedia",
          items: [
            {
              name: "Dodol Nangka Special",
              seller: "Dodol Tradisional",
              price: 35000,
              quantity: 2,
              image: "placeholder",
            },
            {
              name: "Wajik Gula Merah",
              seller: "Dodol Tradisional",
              price: 25000,
              quantity: 3,
              image: "placeholder",
            },
            {
              name: "Lapis Legit Mini",
              seller: "Kue Tradisional Sleman",
              price: 40000,
              quantity: 2,
              image: "placeholder",
            },
          ],
          shipping: {
            address: "Jl. Godean KM 5, Sleman",
            cost: 12000,
          },
          total: 227000,
        },
      ];

      function formatPrice(price) {
        return new Intl.NumberFormat("id-ID", {
          style: "currency",
          currency: "IDR",
          minimumFractionDigits: 0,
        }).format(price);
      }

      function formatDate(dateString) {
        return new Date(dateString).toLocaleDateString("id-ID", {
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      }

      function renderOrders(ordersToRender = orders) {
        const container = document.getElementById("ordersContainer");
        const emptyState = document.getElementById("emptyOrders");

        if (ordersToRender.length === 0) {
          container.innerHTML = "";
          emptyState.classList.remove("hidden");
          return;
        }

        emptyState.classList.add("hidden");
        container.innerHTML = "";

        ordersToRender.forEach((order) => {
          const orderCard = createOrderCard(order);
          container.appendChild(orderCard);
        });
      }

      function createOrderCard(order) {
        const card = document.createElement("div");
        card.className = "bg-white rounded-lg shadow-md overflow-hidden";

        const totalItems = order.items.reduce(
          (sum, item) => sum + item.quantity,
          0
        );

        card.innerHTML = `
                <div class="p-4 sm:p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="font-semibold text-gray-800 text-sm sm:text-base">#${
                              order.id
                            }</h3>
                            <p class="text-xs sm:text-sm text-gray-600">${formatDate(
                              order.date
                            )}</p>
                        </div>
                        <span class="${
                          order.statusClass
                        } px-2 sm:px-3 py-1 rounded-full text-xs sm:text-sm font-medium">
                            ${order.statusText}
                        </span>
                    </div>

                    <div class="space-y-3 mb-4">
                        ${order.items
                          .map(
                            (item, itemIndex) => `
                            <div class="flex items-center space-x-3">
                                <div class="bg-gray-300 w-10 h-10 sm:w-12 sm:h-12 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-image text-gray-500 text-xs sm:text-sm"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <h4 class="font-medium text-gray-800 text-xs sm:text-sm truncate">${
                                      item.name
                                    }</h4>
                                    <p class="text-xs text-gray-600 truncate">${
                                      item.seller
                                    }</p>
                                    <p class="text-xs sm:text-sm text-primary font-medium">${formatPrice(
                                      item.price
                                    )} x ${item.quantity}</p>
                                </div>
                                ${
                                  order.canReview
                                    ? `
                                    <div class="flex-shrink-0">
                                        ${
                                          order.reviewedItems &&
                                          order.reviewedItems.includes(
                                            itemIndex
                                          )
                                            ? `
                                            <button onclick="viewExistingReview('${order.id}', ${itemIndex})" class="text-green-600 text-xs font-medium hover:text-green-700 transition duration-300">
                                                <i class="fas fa-check-circle mr-1"></i>Diulas
                                            </button>
                                        `
                                            : `
                                            <button onclick="openDirectItemReview('${order.id}', ${itemIndex})" class="bg-primary text-white px-2 py-1 rounded text-xs hover:bg-primary-dark transition duration-300">
                                                <i class="fas fa-star mr-1"></i>Ulas
                                            </button>
                                        `
                                        }
                                    </div>
                                `
                                    : ""
                                }
                            </div>
                        `
                          )
                          .join("")}
                    </div>

                    <div class="bg-gray-50 rounded-lg p-2 sm:p-3 mb-4">
                        <div class="flex justify-between text-xs sm:text-sm">
                            <span class="text-gray-600">${totalItems} item â€¢ ${
          order.statusText
        }</span>
                            <span class="font-semibold text-gray-800">Total: ${formatPrice(
                              order.total
                            )}</span>
                        </div>
                    </div>

                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-2 sm:space-y-0">
                        <div class="flex flex-wrap gap-2 w-full sm:w-auto">
                            <button onclick="viewOrderDetail('${
                              order.id
                            }')" class="bg-gray-200 text-gray-700 px-3 sm:px-4 py-2 rounded-md hover:bg-gray-300 text-xs sm:text-sm flex items-center">
                                <i class="fas fa-eye mr-1 text-xs"></i>Detail
                            </button>
                            
                            ${
                              order.status === "unpaid"
                                ? `
                                <button onclick="goToPayment('${order.id}')" class="bg-primary text-white px-3 sm:px-4 py-2 rounded-md hover:bg-primary-dark text-xs sm:text-sm flex items-center">
                                    <i class="fas fa-credit-card mr-1 text-xs"></i>Bayar
                                </button>
                            `
                                : ""
                            }
                            
                            ${
                              order.status === "payment_pending" ||
                              order.status === "payment_rejected" ||
                              order.status === "paid"
                                ? `
                                <button onclick="viewPaymentStatus('${order.id}')" class="bg-blue-500 text-white px-3 sm:px-4 py-2 rounded-md hover:bg-blue-600 text-xs sm:text-sm flex items-center">
                                    <i class="fas fa-receipt mr-1 text-xs"></i>Status Bayar
                                </button>
                            `
                                : ""
                            }
                            
                            ${
                              order.status === "payment_rejected"
                                ? `
                                <button onclick="uploadNewProof('${order.id}')" class="bg-orange-500 text-white px-3 sm:px-4 py-2 rounded-md hover:bg-orange-600 text-xs sm:text-sm flex items-center">
                                    <i class="fas fa-upload mr-1 text-xs"></i>Upload Ulang
                                </button>
                            `
                                : ""
                            }
                            
                            ${
                              order.status === "shipped"
                                ? `
                                <button onclick="trackOrder('${order.id}')" class="bg-blue-500 text-white px-3 sm:px-4 py-2 rounded-md hover:bg-blue-600 text-xs sm:text-sm flex items-center">
                                    <i class="fas fa-truck mr-1 text-xs"></i>Lacak
                                </button>
                            `
                                : ""
                            }
                            
                            ${
                              order.canReview
                                ? `
                                <button onclick="openReviewModal('${order.id}')" class="bg-primary text-white px-3 sm:px-4 py-2 rounded-md hover:bg-primary-dark text-xs sm:text-sm flex items-center">
                                    <i class="fas fa-star mr-1 text-xs"></i>Ulasan
                                </button>
                            `
                                : ""
                            }
                            
                            ${
                              order.status === "unpaid"
                                ? `
                                <button onclick="cancelOrder('${order.id}')" class="bg-red-500 text-white px-3 sm:px-4 py-2 rounded-md hover:bg-red-600 text-xs sm:text-sm flex items-center">
                                    <i class="fas fa-times mr-1 text-xs"></i>Batal
                                </button>
                            `
                                : ""
                            }
                        </div>
                        
                        <div class="flex-shrink-0 w-full sm:w-auto mt-2 sm:mt-0">
                            ${
                              order.status === "completed" && !order.canReview
                                ? `
                                <span class="text-green-600 text-xs sm:text-sm">
                                    <i class="fas fa-check mr-1"></i>Sudah direview
                                </span>
                            `
                                : ""
                            }
                            
                            ${
                              order.status === "shipped"
                                ? `
                                <button onclick="confirmReceived('${order.id}')" class="bg-green-500 text-white px-3 sm:px-4 py-2 rounded-md hover:bg-green-600 text-xs sm:text-sm flex items-center w-full sm:w-auto justify-center">
                                    <i class="fas fa-check mr-1 text-xs"></i>Terima
                                </button>
                            `
                                : ""
                            }
                        </div>
                    </div>
                </div>
            `;

        return card;
      }

      function filterByStatus(status) {
        currentFilter = status;

        // Update tab appearance
        document.querySelectorAll(".tab-button").forEach((btn) => {
          btn.className =
            "tab-button border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-4 px-1 text-sm font-medium";
        });

        event.target.className =
          "tab-button border-b-2 border-primary text-primary py-4 px-1 text-sm font-medium";

        applyFilters();
      }

      function applyFilters() {
        const statusFilter =
          document.getElementById("statusFilter").value || currentFilter;
        const searchTerm = document
          .getElementById("searchOrder")
          .value.toLowerCase();
        const startDate = document.getElementById("startDate").value;
        const endDate = document.getElementById("endDate").value;

        let filteredOrders = orders.filter((order) => {
          const matchesStatus = !statusFilter || order.status === statusFilter;
          const matchesSearch =
            !searchTerm ||
            order.id.toLowerCase().includes(searchTerm) ||
            order.items.some((item) =>
              item.name.toLowerCase().includes(searchTerm)
            );
          const matchesDateRange =
            (!startDate || order.date >= startDate) &&
            (!endDate || order.date <= endDate);

          return matchesStatus && matchesSearch && matchesDateRange;
        });

        renderOrders(filteredOrders);
      }

      function viewOrderDetail(orderId) {
        const order = orders.find((o) => o.id === orderId);
        if (!order) return;

        const modal = document.getElementById("orderModal");
        const modalContent = document.getElementById("modalContent");

        let shippingProofHtml = "";
        if (
          order.status === "shipped" &&
          order.shipping &&
          order.shipping.shippingProof &&
          order.shipping.shippingProof.length > 0
        ) {
          shippingProofHtml = `
            <div class="mb-6">
              <h4 class="text-base font-semibold text-gray-800 mb-2">Bukti Pengiriman</h4>
              <div class="flex space-x-3">
                ${order.shipping.shippingProof
                  .slice(0, 3)
                  .map(
                    (url, idx) => `
                      <div class="relative">
                        <img src="${url}" alt="Bukti Pengiriman" class="w-28 h-28 object-cover rounded-lg border" />
                        <span class="absolute top-2 right-2 bg-primary-light text-white text-xs px-2 py-1 rounded">Foto ${
                          idx + 1
                        }</span>
                      </div>
                    `
                  )
                  .join("")}
              </div>
              ${
                order.shipping.shippingNote
                  ? `
                <div class="bg-gray-50 rounded-lg p-3 mt-2">
                  <span class="font-semibold text-gray-700 block mb-1">Catatan Pengiriman:</span>
                  <span class="text-gray-600 text-sm">${order.shipping.shippingNote}</span>
                </div>
              `
                  : ""
              }
            </div>
          `;
        }

        modalContent.innerHTML = `
                <div class="relative">
                    <button onclick="closeOrderModal()" class="absolute top-2 right-2 sm:top-4 sm:right-4 text-gray-500 hover:text-gray-700 z-10 p-2">
                        <i class="fas fa-times text-lg sm:text-2xl"></i>
                    </button>
                    
                    <div class="p-4 sm:p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-lg sm:text-2xl font-bold">#${
                                  order.id
                                }</h2>
                                <p class="text-sm sm:text-base text-gray-600">${formatDate(
                                  order.date
                                )}</p>
                            </div>
                            <span class="${
                              order.statusClass
                            } px-2 sm:px-3 py-1 rounded-full text-xs sm:text-sm font-medium">
                                ${order.statusText}
                            </span>
                        </div>
                    </div>
                    
                    <div class="p-4 sm:p-6">
                        <h3 class="font-semibold mb-4 text-sm sm:text-base">Item Pesanan</h3>
                        <div class="space-y-4 mb-6">
                            ${order.items
                              .map(
                                (item) => `
                                <div class="flex items-center space-x-3 sm:space-x-4 p-3 sm:p-4 bg-gray-50 rounded-lg">
                                    <div class="bg-gray-300 w-12 h-12 sm:w-16 sm:h-16 rounded-lg flex items-center justify-center flex-shrink-0">
                                        <i class="fas fa-image text-gray-500 text-sm sm:text-xl"></i>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <h4 class="font-medium text-sm sm:text-base truncate">${
                                          item.name
                                        }</h4>
                                        <p class="text-xs sm:text-sm text-gray-600 truncate">${
                                          item.seller
                                        }</p>
                                        <div class="flex items-center justify-between mt-2">
                                            <span class="text-primary font-bold text-sm sm:text-base">${formatPrice(
                                              item.price
                                            )}</span>
                                            <span class="text-gray-600 text-xs sm:text-sm">x${
                                              item.quantity
                                            }</span>
                                        </div>
                                    </div>
                                </div>
                            `
                              )
                              .join("")}
                        </div>
                        
                        <h3 class="font-semibold mb-4 text-sm sm:text-base">Alamat Pengiriman</h3>
                        <div class="bg-gray-50 rounded-lg p-3 sm:p-4 mb-6">
                            <p class="text-gray-800 text-sm sm:text-base">${
                              order.shipping.address
                            }</p>
                        </div>
                        
                        <h3 class="font-semibold mb-4 text-sm sm:text-base">Ringkasan Pembayaran</h3>
                        <div class="space-y-2 text-sm sm:text-base">
                            <div class="flex justify-between">
                                <span>Subtotal</span>
                                <span>${formatPrice(
                                  order.total - order.shipping.cost
                                )}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Ongkos Kirim</span>
                                <span>${formatPrice(order.shipping.cost)}</span>
                            </div>
                            <hr class="my-2">
                            <div class="flex justify-between font-semibold text-base sm:text-lg">
                                <span>Total</span>
                                <span class="text-primary">${formatPrice(
                                  order.total
                                )}</span>
                            </div>
                        </div>
                        
                        ${
                          order.trackingNumber
                            ? `
                            <div class="mt-6 p-3 sm:p-4 bg-blue-50 rounded-lg">
                                <h4 class="font-medium text-blue-800 mb-2 text-sm sm:text-base">Nomor Resi</h4>
                                <p class="font-mono text-blue-600 text-sm sm:text-base break-all">${order.trackingNumber}</p>
                            </div>
                        `
                            : ""
                        }
                        
                        ${shippingProofHtml}
                    </div>
                </div>
            `;

        modal.classList.remove("hidden");
      }

      function trackOrder(orderId) {
        const order = orders.find((o) => o.id === orderId);
        if (order && order.trackingNumber) {
          showMessage(
            `Melacak paket dengan resi: ${order.trackingNumber}`,
            "success"
          );
          // In real app, this would redirect to tracking page
        }
      }

      function goToPayment(orderId) {
        // Store order data for payment page
        const order = orders.find((o) => o.id === orderId);
        if (order) {
          localStorage.setItem(
            "orderData",
            JSON.stringify({
              orderId: order.id,
              total: order.total,
              items: order.items,
            })
          );
          window.location.href = "payment.html";
        }
      }

      function viewPaymentStatus(orderId) {
        const order = orders.find((o) => o.id === orderId);
        if (order) {
          let status = "unpaid";
          if (order.paymentStatus === "pending") status = "pending";
          else if (order.paymentStatus === "rejected") status = "rejected";
          else if (order.paymentStatus === "paid") status = "paid";
          else if (order.paymentStatus === "refunded") status = "refunded";

          window.location.href = `payment-status.html?status=${status}&order=${encodeURIComponent(
            order.id
          )}`;
        }
      }

      function uploadNewProof(orderId) {
        window.location.href = `payment-reupload.html?order=${encodeURIComponent(
          orderId
        )}`;
      }

      function confirmReceived(orderId) {
        if (confirm("Apakah Anda sudah menerima pesanan ini?")) {
          const orderIndex = orders.findIndex((o) => o.id === orderId);
          if (orderIndex !== -1) {
            orders[orderIndex].status = "completed";
            orders[orderIndex].statusText = "Selesai";
            orders[orderIndex].statusClass = "bg-green-100 text-green-800";
            orders[orderIndex].canReview = true;
            renderOrders(orders);
            showMessage("Pesanan berhasil dikonfirmasi diterima!", "success");
          }
        }
      }

      function cancelOrder(orderId) {
        if (confirm("Apakah Anda yakin ingin membatalkan pesanan ini?")) {
          const orderIndex = orders.findIndex((o) => o.id === orderId);
          if (orderIndex !== -1) {
            orders[orderIndex].status = "cancelled";
            orders[orderIndex].statusText = "Dibatalkan";
            orders[orderIndex].statusClass = "bg-red-100 text-red-800";
            renderOrders(orders);
            showMessage("Pesanan berhasil dibatalkan!", "success");
          }
        }
      }

      function openDirectItemReview(orderId, itemIndex) {
        currentReviewOrderId = orderId;
        const order = orders.find((o) => o.id === orderId);
        if (!order) return;

        currentReviewItem = {
          orderIndex: orders.indexOf(order),
          itemIndex: itemIndex,
        };
        const item = order.items[itemIndex];

        // Populate product info
        document.getElementById("reviewProductInfo").innerHTML = `
          <div class="flex items-center space-x-3">
            <div class="bg-gray-300 w-16 h-16 rounded-lg flex items-center justify-center flex-shrink-0">
              <i class="fas fa-image text-gray-500 text-xl"></i>
            </div>
            <div class="flex-1">
              <h4 class="font-semibold text-gray-800">${item.name}</h4>
              <p class="text-sm text-gray-600 mb-1">${item.seller}</p>
              <p class="text-primary font-medium">${formatPrice(
                item.price
              )} x ${item.quantity}</p>
            </div>
          </div>
        `;

        // Open review modal directly
        document.getElementById("reviewModal").classList.remove("hidden");
      }

      function openReviewModal(orderId) {
        currentReviewOrderId = orderId;
        const order = orders.find((o) => o.id === orderId);
        if (!order) return;

        // Show items selection modal first
        document.getElementById("reviewOrderId").textContent = `#${orderId}`;

        const itemsList = document.getElementById("reviewItemsList");
        itemsList.innerHTML = "";

        order.items.forEach((item, index) => {
          const isReviewed =
            order.reviewedItems && order.reviewedItems.includes(index);

          const itemDiv = document.createElement("div");
          itemDiv.className = `flex items-center justify-between p-4 border rounded-lg ${
            isReviewed
              ? "bg-green-50 border-green-200"
              : "bg-white border-gray-200"
          }`;

          itemDiv.innerHTML = `
            <div class="flex items-center space-x-3">
              <div class="bg-gray-300 w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0">
                <i class="fas fa-image text-gray-500"></i>
              </div>
              <div class="flex-1">
                <h4 class="font-medium text-gray-800">${item.name}</h4>
                <p class="text-sm text-gray-600">${item.seller}</p>
                <p class="text-sm text-primary font-medium">${formatPrice(
                  item.price
                )} x ${item.quantity}</p>
              </div>
            </div>
            <div>
              ${
                isReviewed
                  ? `<span class="text-green-600 text-sm font-medium">
                     <i class="fas fa-check-circle mr-1"></i>Sudah diulas
                   </span>`
                  : `<button 
                     onclick="openItemReviewModal(${index})" 
                     class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition duration-300 text-sm"
                   >
                     <i class="fas fa-star mr-1"></i>Beri Ulasan
                   </button>`
              }
            </div>
          `;

          itemsList.appendChild(itemDiv);
        });

        document.getElementById("reviewItemsModal").classList.remove("hidden");
      }

      function openItemReviewModal(itemIndex) {
        const order = orders.find((o) => o.id === currentReviewOrderId);
        if (!order) return;

        currentReviewItem = {
          orderIndex: orders.indexOf(order),
          itemIndex: itemIndex,
        };
        const item = order.items[itemIndex];

        // Populate product info
        document.getElementById("reviewProductInfo").innerHTML = `
          <div class="flex items-center space-x-3">
            <div class="bg-gray-300 w-16 h-16 rounded-lg flex items-center justify-center flex-shrink-0">
              <i class="fas fa-image text-gray-500 text-xl"></i>
            </div>
            <div class="flex-1">
              <h4 class="font-semibold text-gray-800">${item.name}</h4>
              <p class="text-sm text-gray-600 mb-1">${item.seller}</p>
              <p class="text-primary font-medium">${formatPrice(
                item.price
              )} x ${item.quantity}</p>
            </div>
          </div>
        `;

        // Close items modal and open review modal
        document.getElementById("reviewItemsModal").classList.add("hidden");
        document.getElementById("reviewModal").classList.remove("hidden");
      }

      function closeReviewItemsModal() {
        document.getElementById("reviewItemsModal").classList.add("hidden");
      }

      function closeOrderModal() {
        document.getElementById("orderModal").classList.add("hidden");
      }

      function closeReviewModal() {
        document.getElementById("reviewModal").classList.add("hidden");
        selectedRating = 0;
        currentReviewItem = null;
        document.querySelectorAll(".rating-star").forEach((star) => {
          star.className =
            "fas fa-star text-gray-300 text-xl sm:text-2xl cursor-pointer rating-star";
        });
        document.getElementById("reviewComment").value = "";
        document.getElementById("reviewMedia").value = "";

        // Clear checkboxes
        document
          .querySelectorAll('#reviewForm input[type="checkbox"]')
          .forEach((checkbox) => {
            checkbox.checked = false;
          });
      }

      function loadMoreOrders() {
        showMessage("Semua pesanan sudah dimuat!", "success");
      }

      function showMessage(message, type) {
        const messageDiv = document.createElement("div");
        messageDiv.className = `fixed top-4 right-4 p-4 rounded-md shadow-lg z-50 ${
          type === "success"
            ? "bg-green-500 text-white"
            : "bg-red-500 text-white"
        }`;
        messageDiv.textContent = message;

        document.body.appendChild(messageDiv);

        setTimeout(() => {
          messageDiv.remove();
        }, 3000);
      }

      // Initialize dummy review data
      function initializeDummyReviews() {
        // Add dummy reviews for the completed order (SLM239999)
        const dummyReviews = [
          {
            key: "review_SLM239999_0",
            data: {
              orderId: "SLM239999",
              itemIndex: 0,
              rating: 5,
              comment:
                "Batik jumputan sangat berkualitas! Warnanya cantik dan bahan sangat halus. Pengiriman juga cepat. Sangat puas dengan pembelian ini.",
              date: "25 Agustus 2025",
              media: [
                {
                  type: "image",
                  url: "https://via.placeholder.com/300x300/4F46E5/FFFFFF?text=Batik+Foto+1",
                  name: "batik_foto_1.jpg",
                },
                {
                  type: "image",
                  url: "https://via.placeholder.com/300x300/7C3AED/FFFFFF?text=Batik+Foto+2",
                  name: "batik_foto_2.jpg",
                },
              ],
            },
          },
          {
            key: "review_SLM239999_2",
            data: {
              orderId: "SLM239999",
              itemIndex: 2,
              rating: 4,
              comment:
                "Kaos motif gudeg lucu dan unik! Bahan nyaman dipakai. Hanya saja ukurannya sedikit kecil dari yang diharapkan.",
              date: "25 Agustus 2025",
              media: [
                {
                  type: "image",
                  url: "https://via.placeholder.com/300x300/10B981/FFFFFF?text=Kaos+Foto",
                  name: "kaos_foto.jpg",
                },
              ],
            },
          },
        ];

        // Store dummy reviews in localStorage
        dummyReviews.forEach((review) => {
          // Always overwrite to ensure latest dummy data is used
          localStorage.setItem(review.key, JSON.stringify(review.data));
        });
      }

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        // Initialize dummy review data
        initializeDummyReviews();

        renderOrders();

        // Rating stars interaction
        document.querySelectorAll(".rating-star").forEach((star) => {
          star.addEventListener("click", function () {
            selectedRating = parseInt(this.dataset.rating);

            document.querySelectorAll(".rating-star").forEach((s, index) => {
              if (index < selectedRating) {
                s.className =
                  "fas fa-star text-yellow-400 text-2xl cursor-pointer rating-star";
              } else {
                s.className =
                  "fas fa-star text-gray-300 text-2xl cursor-pointer rating-star";
              }
            });
          });
        });

        // View existing review function
        window.viewExistingReview = function (orderId, itemIndex) {
          const order = orders.find((o) => o.id === orderId);
          if (!order) return;

          const item = order.items[itemIndex];
          const reviewKey = `review_${orderId}_${itemIndex}`;
          const reviewData = localStorage.getItem(reviewKey);

          if (!reviewData) {
            // If no stored review, show a default reviewed message
            showMessage("Ulasan telah dikirim sebelumnya", "success");
            return;
          }

          const review = JSON.parse(reviewData);

          console.log("Review data loaded:", review); // Debug log

          // Populate product info
          const productInfo = document.getElementById("viewReviewProductInfo");
          productInfo.innerHTML = `
            <div class="flex items-center space-x-3">
              <div class="bg-gray-300 w-16 h-16 rounded-lg flex items-center justify-center flex-shrink-0">
                <i class="fas fa-image text-gray-500 text-xl"></i>
              </div>
              <div class="flex-1">
                <h4 class="font-semibold text-gray-800">${item.name}</h4>
                <p class="text-sm text-gray-600 mb-1">${item.seller}</p>
                <p class="text-primary font-medium">${formatPrice(
                  item.price
                )} x ${item.quantity}</p>
              </div>
            </div>
          `;

          // Populate rating
          const ratingDiv = document.getElementById("viewReviewRating");
          let starsHtml = "";
          for (let i = 1; i <= 5; i++) {
            if (i <= review.rating) {
              starsHtml +=
                '<i class="fas fa-star text-yellow-400 text-xl"></i>';
            } else {
              starsHtml += '<i class="far fa-star text-gray-300 text-xl"></i>';
            }
          }
          ratingDiv.innerHTML = starsHtml;

          // Populate comment
          document.getElementById("viewReviewComment").textContent =
            review.comment || "Tidak ada komentar";

          // Populate media
          const mediaSection = document.getElementById(
            "viewReviewMediaSection"
          );
          const mediaContainer = document.getElementById("viewReviewMedia");

          console.log("Media data:", review.media); // Debug log

          if (review.media && review.media.length > 0) {
            console.log("Showing media section"); // Debug log
            mediaSection.classList.remove("hidden");
            mediaContainer.innerHTML = "";

            review.media.forEach((media, index) => {
              const mediaElement = document.createElement("div");
              mediaElement.className = "relative group cursor-pointer";

              if (media.type === "image") {
                mediaElement.innerHTML = `
                  <img 
                    src="${media.url}" 
                    alt="Review Media ${index + 1}"
                    class="w-full h-24 object-cover rounded-lg border border-gray-200 hover:opacity-75 transition duration-300"
                    onclick="openMediaViewer('${media.url}', 'image')"
                  />
                  <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 rounded-lg transition duration-300 flex items-center justify-center">
                    <i class="fas fa-expand text-white opacity-0 group-hover:opacity-100 transition duration-300"></i>
                  </div>
                `;
              } else if (media.type === "video") {
                mediaElement.innerHTML = `
                  <div class="relative">
                    <video 
                      class="w-full h-24 object-cover rounded-lg border border-gray-200"
                      onclick="openMediaViewer('${media.url}', 'video')"
                    >
                      <source src="${media.url}" type="video/mp4">
                      Browser Anda tidak mendukung video.
                    </video>
                    <div class="absolute inset-0 bg-black bg-opacity-30 rounded-lg flex items-center justify-center">
                      <i class="fas fa-play text-white text-xl"></i>
                    </div>
                  </div>
                `;
              }

              mediaContainer.appendChild(mediaElement);
            });
          } else {
            mediaSection.classList.add("hidden");
          }

          // Populate date
          document.getElementById("viewReviewDate").textContent = review.date;

          // Show modal
          document.getElementById("viewReviewModal").classList.remove("hidden");
        };

        window.closeViewReviewModal = function () {
          document.getElementById("viewReviewModal").classList.add("hidden");
        };

        // Media viewer functions
        window.openMediaViewer = function (url, type) {
          const viewer = document.createElement("div");
          viewer.className =
            "fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4";
          viewer.onclick = function (e) {
            if (e.target === viewer) {
              document.body.removeChild(viewer);
            }
          };

          let mediaContent = "";
          if (type === "image") {
            mediaContent = `
              <div class="relative max-w-4xl max-h-full">
                <img src="${url}" alt="Review Media" class="max-w-full max-h-full object-contain rounded-lg" />
                <button 
                  onclick="document.body.removeChild(this.closest('.fixed'))"
                  class="absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full w-10 h-10 flex items-center justify-center hover:bg-opacity-75 transition duration-300"
                >
                  <i class="fas fa-times"></i>
                </button>
              </div>
            `;
          } else if (type === "video") {
            mediaContent = `
              <div class="relative max-w-4xl max-h-full">
                <video controls class="max-w-full max-h-full rounded-lg" autoplay>
                  <source src="${url}" type="video/mp4">
                  Browser Anda tidak mendukung video.
                </video>
                <button 
                  onclick="document.body.removeChild(this.closest('.fixed'))"
                  class="absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full w-10 h-10 flex items-center justify-center hover:bg-opacity-75 transition duration-300"
                >
                  <i class="fas fa-times"></i>
                </button>
              </div>
            `;
          }

          viewer.innerHTML = mediaContent;
          document.body.appendChild(viewer);
        };

        // Store review data function
        function storeReviewData(orderId, itemIndex, rating, comment) {
          const reviewKey = `review_${orderId}_${itemIndex}`;

          // Get uploaded media files
          const mediaFiles = [];
          const fileInput = document.getElementById("reviewMedia");
          if (fileInput && fileInput.files.length > 0) {
            for (let i = 0; i < fileInput.files.length; i++) {
              const file = fileInput.files[i];
              // In a real app, you would upload these files to a server
              // For demo purposes, we'll create placeholder URLs
              mediaFiles.push({
                type: file.type.startsWith("image/") ? "image" : "video",
                url: URL.createObjectURL(file),
                name: file.name,
              });
            }
          }

          const reviewData = {
            orderId,
            itemIndex,
            rating,
            comment,
            media: mediaFiles,
            date: new Date().toLocaleDateString("id-ID", {
              day: "numeric",
              month: "long",
              year: "numeric",
            }),
          };
          localStorage.setItem(reviewKey, JSON.stringify(reviewData));
        }

        // Review form submission
        document
          .getElementById("reviewForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();

            if (!currentReviewItem) {
              showMessage("Terjadi kesalahan. Silakan coba lagi.", "error");
              return;
            }

            if (selectedRating === 0) {
              showMessage("Harap pilih rating terlebih dahulu!", "error");
              return;
            }

            const comment = document.getElementById("reviewComment").value;
            if (!comment.trim()) {
              showMessage("Harap tulis komentar!", "error");
              return;
            }

            // Get selected improvement reasons
            const selectedReasons = [];
            document
              .querySelectorAll('#reviewForm input[type="checkbox"]:checked')
              .forEach((checkbox) => {
                selectedReasons.push(checkbox.value);
              });

            // Get the order and item being reviewed
            const order = orders[currentReviewItem.orderIndex];
            const item = order.items[currentReviewItem.itemIndex];

            // Simulate review submission
            console.log("Review submitted for item:", item.name);
            console.log("Rating:", selectedRating);
            console.log("Comment:", comment);
            console.log("Improvement suggestions:", selectedReasons);

            // Mark item as reviewed
            if (!order.reviewedItems) {
              order.reviewedItems = [];
            }
            if (!order.reviewedItems.includes(currentReviewItem.itemIndex)) {
              order.reviewedItems.push(currentReviewItem.itemIndex);
            }

            // Store review data for later viewing
            storeReviewData(
              order.id,
              currentReviewItem.itemIndex,
              selectedRating,
              comment
            );

            // Show success message
            showMessage(
              `Terima kasih! Ulasan untuk ${item.name} telah berhasil dikirim.`,
              "success"
            );

            // Close modal and refresh
            closeReviewModal();

            // Re-render orders to show updated review status
            renderOrders(orders);
          });

        // Filter event listeners
        document
          .getElementById("statusFilter")
          .addEventListener("change", applyFilters);
        document
          .getElementById("searchOrder")
          .addEventListener("input", applyFilters);
        document
          .getElementById("startDate")
          .addEventListener("change", applyFilters);
        document
          .getElementById("endDate")
          .addEventListener("change", applyFilters);
      });

      // Close modals when clicking outside
      document
        .getElementById("orderModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeOrderModal();
          }
        });

      document
        .getElementById("reviewModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeReviewModal();
          }
        });

      document
        .getElementById("viewReviewModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeViewReviewModal();
          }
        });
    </script>
  </body>
</html>
