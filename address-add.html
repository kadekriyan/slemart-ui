<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tambah Alamat - Sleman Mart</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      src="https://kit.fontawesome.com/a076d05399.js"
      crossorigin="anonymous"
    ></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#E57F39",
              "primary-dark": "#C86A2B",
              "primary-light": "#F29C5E",
            },
          },
        },
      };
    </script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
      <div class="container mx-auto px-4">
        <div class="flex items-center justify-between h-16">
          <!-- Back Button & Title -->
          <div class="flex items-center space-x-4">
            <button
              onclick="window.location.href='address-list.html'"
              class="text-gray-600 hover:text-primary transition-colors"
            >
              <i class="fas fa-arrow-left text-xl"></i>
            </button>
            <h1 id="pageTitle" class="text-xl font-bold text-gray-800">
              Tambah Alamat
            </h1>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">
      <div class="bg-white rounded-lg shadow-md p-6">
        <h2 id="formTitle" class="text-xl font-bold text-gray-800 mb-6">
          <i class="fas fa-map-marker-alt mr-2 text-primary"></i>Informasi
          Alamat
        </h2>

        <form id="addressForm" class="space-y-6">
          <input type="hidden" id="addressId" name="addressId" />

          <!-- Recipient Name -->
          <div>
            <label
              for="recipientName"
              class="block text-sm font-medium text-gray-700 mb-2"
            >
              Nama Penerima *
            </label>
            <input
              type="text"
              id="recipientName"
              name="recipientName"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-primary focus:border-primary"
              placeholder="Masukkan nama penerima"
              required
            />
          </div>

          <!-- Phone Number -->
          <div>
            <label
              for="recipientPhone"
              class="block text-sm font-medium text-gray-700 mb-2"
            >
              Nomor Telepon Penerima *
            </label>
            <input
              type="tel"
              id="recipientPhone"
              name="recipientPhone"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-primary focus:border-primary"
              placeholder="+62 812-3456-7890"
              required
            />
          </div>

          <!-- Address Label -->
          <!-- <div>
            <label
              for="addressLabel"
              class="block text-sm font-medium text-gray-700 mb-2"
            >
              Label Alamat
            </label>
            <div class="flex space-x-2 mb-2">
              <button
                type="button"
                onclick="setAddressLabel('Rumah')"
                class="px-3 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 transition-colors"
              >
                <i class="fas fa-home mr-1"></i>Rumah
              </button>
              <button
                type="button"
                onclick="setAddressLabel('Kantor')"
                class="px-3 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 transition-colors"
              >
                <i class="fas fa-building mr-1"></i>Kantor
              </button>
              <button
                type="button"
                onclick="setAddressLabel('Lainnya')"
                class="px-3 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-50 transition-colors"
              >
                <i class="fas fa-tag mr-1"></i>Lainnya
              </button>
            </div>
            <input
              type="text"
              id="addressLabel"
              name="addressLabel"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-primary focus:border-primary"
              placeholder="Masukkan label alamat"
            />
          </div> -->

          <!-- Full Address -->
          <div>
            <label
              for="fullAddress"
              class="block text-sm font-medium text-gray-700 mb-2"
            >
              Alamat Lengkap *
            </label>
            <textarea
              id="fullAddress"
              name="fullAddress"
              rows="3"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-primary focus:border-primary"
              placeholder="Masukkan alamat lengkap termasuk nama jalan, nomor rumah, RT/RW"
              required
            ></textarea>
          </div>

          <!-- City/Kabupaten -->
          <div>
            <label
              for="city"
              class="block text-sm font-medium text-gray-700 mb-2"
            >
              Kabupaten/Kota *
            </label>
            <select
              id="city"
              name="city"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-primary focus:border-primary"
              required
              onchange="loadDistricts()"
            >
              <option value="">Pilih Kabupaten/Kota</option>
              <option value="Kabupaten Sleman">Kabupaten Sleman</option>
              <option value="Kota Yogyakarta">Kota Yogyakarta</option>
              <option value="Kabupaten Bantul">Kabupaten Bantul</option>
              <option value="Kabupaten Kulon Progo">
                Kabupaten Kulon Progo
              </option>
              <option value="Kabupaten Gunung Kidul">
                Kabupaten Gunung Kidul
              </option>
            </select>
          </div>

          <!-- District/Kecamatan -->
          <div>
            <label
              for="district"
              class="block text-sm font-medium text-gray-700 mb-2"
            >
              Kecamatan *
            </label>
            <select
              id="district"
              name="district"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-primary focus:border-primary"
              required
              disabled
            >
              <option value="">Pilih Kecamatan</option>
            </select>
            <p class="text-xs text-gray-500 mt-1">
              Pilih Kabupaten/Kota terlebih dahulu
            </p>
          </div>

          <!-- Postal Code -->
          <div>
            <label
              for="postalCode"
              class="block text-sm font-medium text-gray-700 mb-2"
            >
              Kode Pos *
            </label>
            <input
              type="text"
              id="postalCode"
              name="postalCode"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-primary focus:border-primary"
              placeholder="55xxx"
              pattern="[0-9]{5}"
              maxlength="5"
              required
            />
            <p class="text-xs text-gray-500 mt-1">Masukkan 5 digit kode pos</p>
          </div>

          <!-- Set as Default -->
          <div class="flex items-center p-4 bg-gray-50 rounded-lg">
            <input
              type="checkbox"
              id="isDefault"
              name="isDefault"
              class="text-primary focus:ring-primary border-gray-300 rounded"
            />
            <label for="isDefault" class="ml-3 text-sm text-gray-700">
              <i class="fas fa-star mr-2 text-yellow-500"></i>Jadikan alamat
              utama
            </label>
          </div>

          <!-- Action Buttons -->
          <div class="flex space-x-3 pt-4">
            <button
              type="button"
              onclick="window.location.href='address-list.html'"
              class="flex-1 border border-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-50 transition-colors"
            >
              <i class="fas fa-times mr-2"></i>Batal
            </button>
            <button
              type="submit"
              class="flex-1 bg-primary text-white py-3 px-4 rounded-lg font-medium hover:bg-primary-dark transition-colors"
            >
              <i class="fas fa-save mr-2"></i>Simpan
            </button>
          </div>
        </form>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-16">
      <div class="container mx-auto px-4">
        <div class="text-center">
          <h3 class="text-xl font-bold mb-2">Sleman Mart</h3>
          <p class="text-gray-400">Platform UMKM Digital Kabupaten Sleman</p>
        </div>
      </div>
    </footer>

    <script>
      // District data for each city
      const districtData = {
        "Kabupaten Sleman": [
          "Berbah",
          "Cangkringan",
          "Depok",
          "Gamping",
          "Godean",
          "Kalasan",
          "Minggir",
          "Mlati",
          "Moyudan",
          "Ngaglik",
          "Ngemplak",
          "Pakem",
          "Prambanan",
          "Seyegan",
          "Sleman",
          "Tempel",
          "Turi",
        ],
        "Kota Yogyakarta": [
          "Danurejan",
          "Gedongtengen",
          "Gondokusuman",
          "Gondomanan",
          "Jetis",
          "Kotagede",
          "Kraton",
          "Mantrijeron",
          "Mergangsan",
          "Ngampilan",
          "Pakualaman",
          "Tegalrejo",
          "Umbulharjo",
          "Wirobrajan",
        ],
        "Kabupaten Bantul": [
          "Bambanglipuro",
          "Banguntapan",
          "Bantul",
          "Dlingo",
          "Imogiri",
          "Jetis",
          "Kasihan",
          "Kretek",
          "Pajangan",
          "Pandak",
          "Piyungan",
          "Pleret",
          "Sabdodadi",
          "Sedayu",
          "Sewon",
          "Srandakan",
          "Ubud",
        ],
        "Kabupaten Kulon Progo": [
          "Galur",
          "Girimulyo",
          "Kalibawang",
          "Kokap",
          "Lendah",
          "Nanggulan",
          "Pajangan",
          "Pengasih",
          "Panjatan",
          "Samigaluh",
          "Sentolo",
          "Temon",
          "Wates",
        ],
        "Kabupaten Gunung Kidul": [
          "Gedangsari",
          "Girisubo",
          "Karangmojo",
          "Ngawen",
          "Nglipar",
          "Panggang",
          "Patuk",
          "Playen",
          "Ponjong",
          "Purwosari",
          "Rongkop",
          "Sapta Sari",
          "Semin",
          "Semanu",
          "Tepus",
          "Tanjungsari",
          "Wonosari",
          "Wunung",
        ],
      };

      let currentEditingAddressId = null;

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        setupEventListeners();
        checkEditMode();
      });

      // Check if in edit mode
      function checkEditMode() {
        const urlParams = new URLSearchParams(window.location.search);
        const editId = urlParams.get("edit");

        if (editId) {
          currentEditingAddressId = editId;
          document.getElementById("pageTitle").textContent = "Edit Alamat";
          document.getElementById("formTitle").innerHTML =
            '<i class="fas fa-edit mr-2 text-primary"></i>Edit Informasi Alamat';
          loadAddressData(editId);
        }
      }

      // Load address data for editing
      function loadAddressData(addressId) {
        const addresses = JSON.parse(
          localStorage.getItem("userAddresses") || "[]"
        );
        const address = addresses.find((addr) => addr.id === addressId);

        if (address) {
          document.getElementById("addressId").value = address.id;
          document.getElementById("recipientName").value =
            address.recipientName;
          document.getElementById("recipientPhone").value = address.phone;
          document.getElementById("addressLabel").value = address.label || "";
          document.getElementById("fullAddress").value = address.fullAddress;
          document.getElementById("city").value = address.city || "";
          document.getElementById("postalCode").value = address.postalCode;
          document.getElementById("isDefault").checked = address.isDefault;

          // Load districts if city is selected
          if (address.city) {
            loadDistricts();
            setTimeout(() => {
              document.getElementById("district").value =
                address.district || "";
            }, 100);
          }
        }
      }

      // Load districts based on selected city
      function loadDistricts() {
        const citySelect = document.getElementById("city");
        const districtSelect = document.getElementById("district");
        const selectedCity = citySelect.value;

        // Clear district options
        districtSelect.innerHTML = '<option value="">Pilih Kecamatan</option>';

        if (selectedCity && districtData[selectedCity]) {
          // Enable district select
          districtSelect.disabled = false;

          // Add district options
          districtData[selectedCity].forEach((district) => {
            const option = document.createElement("option");
            option.value = district;
            option.textContent = district;
            districtSelect.appendChild(option);
          });

          // Update help text
          districtSelect.nextElementSibling.textContent = `Pilih kecamatan di ${selectedCity}`;
        } else {
          districtSelect.disabled = true;
          districtSelect.nextElementSibling.textContent =
            "Pilih Kabupaten/Kota terlebih dahulu";
        }
      }

      // Set address label
      function setAddressLabel(label) {
        document.getElementById("addressLabel").value = label;

        // Update button styles
        document
          .querySelectorAll('[onclick*="setAddressLabel"]')
          .forEach((btn) => {
            btn.classList.remove("bg-primary", "text-white", "border-primary");
            btn.classList.add("border-gray-300", "hover:bg-gray-50");
          });

        // Highlight selected button
        event.target.classList.remove("border-gray-300", "hover:bg-gray-50");
        event.target.classList.add(
          "bg-primary",
          "text-white",
          "border-primary"
        );
      }

      // Save address
      function saveAddress() {
        const form = document.getElementById("addressForm");
        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }

        const formData = new FormData(form);

        const addressData = {
          id: currentEditingAddressId || "addr_" + Date.now(),
          recipientName: formData.get("recipientName"),
          phone: formData.get("recipientPhone"),
          label: formData.get("addressLabel"),
          fullAddress: formData.get("fullAddress"),
          city: formData.get("city"),
          district: formData.get("district"),
          postalCode: formData.get("postalCode"),
          isDefault: formData.get("isDefault") === "on",
        };

        let addresses = JSON.parse(
          localStorage.getItem("userAddresses") || "[]"
        );

        // If setting as default, remove default from other addresses
        if (addressData.isDefault) {
          addresses = addresses.map((addr) => ({ ...addr, isDefault: false }));
        }

        if (currentEditingAddressId) {
          // Update existing address
          const index = addresses.findIndex(
            (addr) => addr.id === currentEditingAddressId
          );
          addresses[index] = addressData;
        } else {
          // Add new address
          addresses.unshift(addressData);
        }

        localStorage.setItem("userAddresses", JSON.stringify(addresses));

        // Show success message and redirect
        alert(
          currentEditingAddressId
            ? "Alamat berhasil diperbarui!"
            : "Alamat berhasil ditambahkan!"
        );
        window.location.href = "address-list.html";
      }

      // Setup event listeners
      function setupEventListeners() {
        // Address form
        document
          .getElementById("addressForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();
            saveAddress();
          });

        // Postal code input validation
        document
          .getElementById("postalCode")
          .addEventListener("input", function (e) {
            e.target.value = e.target.value.replace(/[^0-9]/g, "").slice(0, 5);
          });
      }
    </script>
  </body>
</html>
